
@{
    ViewBag.Title = "PackegingAesthQc";
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}

<style>
    .ui-autocomplete {
        max-height: 150px;
        overflow: auto;
        float: left;
    }

    .modal-dialog {
        min-width: 100%;
        margin: 0;
    }

</style>
<div class="breadcrumb-holder container-fluid">
    <ul class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Packaging QC </a></li>
        <li class="breadcrumb-item active">Packaging Asthetic Qc</li>
    </ul>
</div>
<section class="forms">
    <div class="container-fluid">
        <div class="row">
           
            <div class="col-lg-7">
                <div class="card">
                    <div class="card-close">

                    </div>
                   
                    <div class="card-header d-flex align-items-center" style="background-color: #057EB3;color: white">
                        <h3 class="h4">Add Packaging Asthetic Qc  Result</h3>
                    </div>

                    <div class="card-body">

                        <div class="form-horizontal" style="margin-top: 30px;">

                            <div class="form-group row">
                                &nbsp; &nbsp;
                            </div>
                            <div class="form-group row" id="divImei1" style="">
                                <label class="col-sm-3 form-control-label">Imei Number</label>
                                <div class="col-sm-6">
                                    <input id="txtImei" type="text" maxlength="17" placeholder=" Scan Imei" required="" class="form-control form-control-success">


                                </div>

                                <input class="btn btn-warning" type="submit" id="btnImeiClear" value="clear" />
                            </div>
                            
                            @*<div class="form-group row" id="divImei1" style="">
                                <label class="col-sm-3 form-control-label">Imei 1</label>
                                <div class="col-sm-7">
                                    <input id="txtImei1" type="text" readonly="readonly" placeholder=" Scan Imei 1" required="" class="form-control form-control-success">


                                </div>
                            </div>

                            <div class="form-group row" id="divImei2" style="">
                                <label class="col-sm-3 form-control-label">Imei 2</label>
                                <div class="col-sm-7">
                                    <input id="txtImei2" type="text" readonly="readonly" placeholder=" Scan Imei 2" required="" class="form-control form-control-success">


                                </div>
                            </div>*@


                            @*<div class="form-group row" id="divIssue" style="display: none">
                                <label class="col-sm-3 form-control-label">Issues</label>
                                <div class="col-sm-7">
                                   

                                    <textarea id="txtIssues" name="txtIssues" placeholder="Type Issues Name" required="" style="height: 150px;" class="form-control"></textarea>
                                </div>
                              
                                <label class="col-sm-9 form-control-label">&nbsp;</label>
                                <div class="col-sm-9">
                                    <div class="col-sm-9 offset-sm-3">

                                        <button class="btn btn-primary" id="btnSave" style="width: 200px;"><i class="fa fa-plus"></i> Save</button>

                                    </div>
                                </div>
                            </div>*@


                            @*<div class="form-group row">
                                <label class="col-sm-3 form-control-label">&nbsp;</label>
                                <div class="i-checks col-sm-6">
                                    <input id="chkPassed" checked="checked" type="checkbox" value="y" class="checkbox-template">
                                    <label for="chkPassed">Passed</label>
                                    &nbsp; &nbsp;
                                    <input id="chkFailed" type="checkbox" value="n" class="checkbox-template">
                                    <label for="chkFailed">Failed</label>
                                </div>
                            </div>*@

                            <div class="form-group row">
                                &nbsp; &nbsp;
                            </div>

                            

                            <div class="form-group row">
                                &nbsp; &nbsp;
                            </div>


                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-5" id="cirDiv">

                <div class="card" style="border: 2px solid darkcyan">
                    <div class="card-header d-flex align-items-center" style="background-color: darkcyan;color: white">
                        <h3 class="h4" style="font-weight: normal">Packaging Aesthetic Station Count</h3>
                    </div>


                    <div class="card-body" style="font-size: 20px;">

                        <div class="form-group row" style="font-size: 20px;">
                            &nbsp;


                        </div>

                        <div class="form-group row" style="font-size: 20px;">
                            <label class="col-sm-7 form-control-label" style="font-size: 20px; color: #3D2C78; ">Total Checked:</label>
                            <div class="col-sm-5" id="mbCode">
                                <h2 id="idCountAll" style="font-size: 30px; color: #3D2C78; "></h2>

                            </div>


                        </div>


                        <div class="form-group row" style="font-size: 20px;">
                            <label class="col-sm-7 form-control-label" style="font-size: 20px; color: #0C9050; ">Passed:</label>
                            <div class="col-sm-5" id="mbCode">
                                <h2 id="idCountPass" style="font-size: 30px; color: #0C9050;"></h2>

                            </div>


                        </div>




                        <div class="form-group row" style="font-size: 20px;">
                            <label class="col-sm-7 form-control-label" style="font-size: 20px; color: #F53E16; ">Failed:</label>
                            <div class="col-sm-5" id="mbCode">
                                <h2 id="idCountFail" style="font-size: 30px; color: #F53E16;"></h2>

                            </div>


                        </div>


                        @*<h1><span class="badge badge-primary" style="font-size:15px; ">Last Three Scanned Mobile Code</span></h1>
                <div class="form-group row">



                    <table class="table table-bordered table-hover">
                        <thead style="text-align: center">
                            <tr>

                                <th>
                                    CODE

                                </th>
                                <th>
                                    IMEI-1
                                </th>
                                <th>
                                    IMEI-2
                                </th>
                                <th>
                                    Status
                                </th>

                            </tr>
                        </thead>
                        <tbody class="tbody"></tbody>
                    </table>
                </div>*@

                    </div>
                </div>
            </div>

        </div>

    </div>

</section>

@*//modal*@


<div class="modal fade" id="myModal" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" style="border: 1px solid #922602">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header" style="text-align: center; background-color: #072F4F;color:white ">
                <h4 class="modal-title" style="text-align: center;">Aesthetic Error List</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">

                <div class="container">
                    <div class="row" id="modIssues">


                    </div>
                    <div class="form-group row" style="margin-left: 8px;">

                        <div class="i-checks col-sm-10" style="">
                            <input id="chkOthers" type="checkbox" value="y" class="checkbox-template">
                            <label for="chkOthers" style="color:#f53e16;font-weight: bold">Others</label> &nbsp;&nbsp;
                            <input id="txtOthers" type="text" style="display: none;width: 200px;" required="" class="form-control form-control-success">
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                <button class="btn btn-primary" id="btnSave" style="width: 200px;"> Save</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->








<link href="~/css/iziToast.min.css" rel="stylesheet" />
<link href="~/js/vendor/JqueryChoosen/chosen-bootstrap.css" rel="stylesheet" />
<link href="~/js/vendor/JqueryChoosen/chosen.css" rel="stylesheet" />
<link href="~/js/vendor/JQueryEasyUI/themes/black/easyui.css" rel="stylesheet" />
<script type="text/javascript" src="~/js/vendor/jquery.easyui.min.js"></script>
<script src="~/js/iziToast.min.js"></script>
<script src="~/js/vendor/JqueryChoosen/chosen.jquery.min.js"></script>
<script>
    $("#chkOthers").click(function () {

        if ($(this).is(':checked')) {

            $('#txtOthers').show();
            $('#txtOthers').focus();
        }

        else
            $('#txtOthers').hide();
        $('#txtOthers').val('');

    });
    function GetAllIssueListAesthetic() {

        $.ajax({
            url: '  @Url.Action("GetAllIssueListAesthetic", "Production")',
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            success: function (data) {
                if (data.length == 0) {
                    $('#modIssues').empty();
                    $('#modIssues').append('<div class="statistic d-flex align-items-center bg-white has-shadow" ><div class="icon bg-green"><i class="fa fa-calendar-o"></i></div><div class="text"><small>No ongoing task available</small></div></div>');

                    return false;
                } else {

                    $('#modIssues').empty();
                    $.each(data, function (index, itemData) {


                        $("#modIssues").append('<div class="col-md-4"><form><div class="form-check"><label><input type="checkbox"  name="Errorcheck" value="' + itemData.Name + '"> <span class="label-text">' + itemData.Name + '</span></label></div></form> </div>');
                    });

                }

            },
            error: function (result, textStatus, jqXHR) {
                //toastr.error(result.Message);
                // alert("Error");
                return false;
            }
        });
    }

    @*function GetLastthreeEntry() {


        $.ajax({
            url: "  @Url.Action("GetLastThreeCount", "Production")",
            type: "GET",
            data: { flag: "PACKGAESTHQC" },
        contentType: "application/json;charset=utf-8",
        dataType: "json",
        success: function (result) {
            var html = '';
            $.each(result, function (key, item) {

                var stat = "";

                if (item.Passed == "Y") {
                    stat = "Passed";
                }
                if (item.Passed == "N") {
                    stat = "Failed";
                }

                html += '<tr>';
                html += '<td style="text-align:center">' + item.MobileCode + '</td>';
                html += '<td style="text-align:center">' + item.Imei1 + '</td>';
                html += '<td style="text-align:center">' + item.Imei2 + '</td>';
                html += '<td style="text-align:center">' + stat + '</td>';


                html += '</tr>';
            });
            $('.tbody').html(html);
        },
        error: function (errormessage) {
            alert(errormessage.responseText);
        }
    });

        
    }*@

    //window.setInterval(function () {

    //    CountPackagingQc();
    //}, 1000);
    function CountPackagingQc() {

        $.ajax({
            url: '  @Url.Action("GetPackagingAestheticCount", "Production")',
            type: 'GET',
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            success: function (result) {

                if (result.length == 0) {
                    $('#idCountAll').text('0');
                    $('#idCountPass').text('0');
                    $('#idCountFail').text('0');
                }
                else {
                    $('#idCountAll').text(result[0].totalFunctionQc);
                    $('#idCountPass').text(result[0].passedCount);
                    $('#idCountFail').text(result[0].failedCount);
                }

            },
            error: function (result, textStatus, jqXHR) {
                //toastr.error(result.Message);
                // alert("Error");
                return false;
            }
        });


    }


    $('input.checkbox-template').on('change', function () {
        debugger;
        $('input.checkbox-template').not(this).prop('checked', false);
        var checkedValue= $('input.checkbox-template:checked').val();
        if (checkedValue == 'n') {

            $("#divIssue").show();
            $("#txtIssues").focus();
            

        } else {
            $("#divIssue").hide();
            $("#txtIssues").val('');
            $("#txtImei").focus();
            

        }

    });



    function SaveFunctionQC(code) {
        // return false;

        debugger;
        var functionalQcList = [];
        var mobileCode = code.slice(0, -1);
        var status = (code.slice(-1)).toLowerCase();
        //var radioVal = $('input[name=radioCheck]:checked').val();
        //var issues = $("#txtIssues").val();
        // console.log(radioVal);
        if ($("#txtMobileCode").val() == "") {


            iziToast.warning({
                timeout: 1000,
                imageWidth: 150,
                position: 'center',
                title: 'Warning',
                message: 'Mobile Code Required'
            });
            return false;
        }
        if (status == "y") {

            functionalQcList.push({
                MobileCode: mobileCode,
                Passed: status,
                QcStation: "PACKGAESTHQC",

            });

        }
        ///Insert Data

        $.ajax({
            url: '@Url.Action("InsertFunctionalQcStatus", "Production")',
            type: 'Post',
            data: JSON.stringify({ statusList: functionalQcList }),
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            success: function (result) {

                if (result.IsSuccess) {
                    iziToast.success({
                        timeout: 2000,
                        imageWidth: 150,
                        position: 'center',
                        title: 'Success',
                        message: 'Result Saved Successfully'
                    });
                    AllClear();
                    $("#divHistory").hide();
                    return true;
                    //location.reload();
                }
                else if (result.Id == "0") {
                    window.location = '@Url.Action("LogOut", "Account")';

                }

                else {
                    iziToast.error({
                        timeout: 2000,
                        imageWidth: 150,
                        position: 'center',
                        title: 'Error',
                        message: 'Error Occured While Saving'
                    });
                }

            },
            error: function (result, textStatus, jqXHR) {
                iziToast.error({
                    timeout: 2000,
                    imageWidth: 150,
                    position: 'center',
                    title: 'Error',
                    message: result
                });

                //return false;
            }
        });
        //Insert Data

    }



    $("#btnSave").click(function () {
        debugger;
        var code = $("#txtImei").val();


        var imeiCode = code.slice(0, -2);

        var status = code.slice(-1);


        var productionMaster = {};
        var rework = {};

        debugger;
        


        

        if (status.toLowerCase() == 'n') {
            var checkedNum = $('input[name="Errorcheck"]:checked').length;


            if (!checkedNum && $('#txtOthers').val() == "") {
                iziToast.warning({
                    timeout: 2000,
                    imageWidth: 150,
                    position: 'center',
                    title: 'Warning',
                    backgroundColor: '#E70F0F',
                    theme: 'dark', // dark
                    message: 'Please Select Issues',
                    messageColor: '#FDFEFE',
                });
              
                return false;
            }
            

            if ($("#txtImei").val() == '') {


                iziToast.warning({
                    timeout: 1000,
                    imageWidth: 150,
                    position: 'center',
                    title: 'Warning',
                    message: 'IMEI numbers required !'
                });
                return false;
            }
          

            else {

                $('#myModal').modal('hide');
                productionMaster.Imei1 = imeiCode;
                //productionMaster.Imei2 = $("#txtImei2").val();
                productionMaster.Passed = status;
                productionMaster.QcStation = "PACKGAESTHQC";

                var issues = '';

                $('input[name="Errorcheck"]:checked').each(function () {
                    //console.log(this.value);
                    issues += this.value + ',';

                });
                if ($('#txtOthers').val() != "") {

                    issues += $('#txtOthers').val();
                }

                rework.Imei1 = imeiCode;
                rework.Imei2 = $("#txtImei2").val();
                rework.Issues = issues; //$("#txtIssues").val();
                //productionMaster.Passed = $('input.checkbox-template:checked').val();
                rework.FailedStation = "PACKGAESTHQC";



                $.ajax({
                    url: ' @Url.Action("PackagingQcResult", "Production")',
                    type: 'Post',
                    data: JSON.stringify({ productionMaster: productionMaster, rework: rework }),
                    dataType: 'json',
                    async: false,
                    contentType: 'application/json',
                    success: function (result) {

                        if (result.IsSuccess) {
                            
                            location.reload();
                            AllClear();
                            CountPackagingQc();
                            $("#txtImei").val('');
                            $("#txtImei").focus();
                            return true;
                           
                        } else {
                            iziToast.warning({
                                timeout: 2000,
                                imageWidth: 150,
                                position: 'center',
                                title: 'Warning',
                                backgroundColor: '#E70F0F',
                                theme: 'dark', // dark
                                message: result.Message,
                                messageColor: '#FDFEFE',
                            });


                            $("#txtImei").val('');
                            $("#txtImei").focus();
                            $("#txtImei1").val('');
                            $("#txtImei2").val('');
                            AllClear();
                        }

                    },
                    error: function (result, textStatus, jqXHR) {
                        iziToast.error({
                            timeout: 2000,
                            imageWidth: 150,
                            position: 'center',
                            title: 'Error',
                            message: result
                        });
                    }
                });
            }
        }
    });
    $("#btnImeiClear").click(function () {
        $("#txtImei1").val('');
        $("#txtImei2").val('');
        $("#txtImei").val('');
        $("#txtImei").focus();
        $('#divIssue').hide();
        $('#txtImei').focus();
        $('#chkPassed').prop("checked", true);
        $('#chkFailed').prop("checked", false);
       

    });

    $(document).ready(function () {
        //GetLastthreeEntry();
      
        CountPackagingQc();
        $('#txtImei').focus();

        @*var issues = [];
        $.ajax({
            url: " @Url.Action("GetAllIssueList", "Project")",
            type: 'GET',
            dataType: 'json',
            async: true,
            contentType: 'application/json',
            success: function(data) {
                $.each(data, function(index, itemData) {
                    issues.push(
                        itemData.value
                    );
                });
                console.log(issues);
            },
            error: function(data, textStatus, jqXHR) {

            }
        });

        function split(val) {
            return val.split(/,\s*/);
        }

        function extractLast(term) {
            return split(term).pop();
        }

        var te = [];
        $("#txtIssues")
            .on("keydown", function(event) {
                if (event.keyCode === $.ui.keyCode.TAB &&
                    $(this).autocomplete("instance").menu.active) {
                    event.preventDefault();
                }
            })
            .autocomplete({
                minLength: 0,
                source: function(request, response) {

                    console.log(issues.la);
                    response($.ui.autocomplete.filter(
                        issues, extractLast(request.term)));
                },
                focus: function() {

                    return false;
                },
                select: function(event, ui) {
                    var terms = split(this.value);
                    terms.pop();
                    terms.push(ui.item.value);
                    terms.push("");
                    this.value = terms.join(",");
                    return false;
                }
            });*@
    });


    function AllClear() {

        $("#txtImei1").val('');
        $("#txtImei2").val('');
        $("#txtImei").val('');
        $("#txtIssues").val('');
        $("#txtMobileCode").val('');
        $('.checkbox-template').prop('checked', false);
        $('#divIssue').hide();

    }


    $("#txtImei").keydown(function() {
        debugger;
        var imei1 = $("#txtImei").val();
        var imei2 = $("#txtImei").val();

        var lastTwoDigits = this.value.slice(-2);
        if (lastTwoDigits.toLowerCase() == '-y') {

            var productionMaster = {};
            var rework = {};
            productionMaster.Imei1 = imei1.substring(0, imei1.length - 2);
            productionMaster.Imei2 = imei2.substring(0, imei2.length - 2);
            productionMaster.Passed = "Y";
            productionMaster.QcStation = "PACKGAESTHQC";


            //save packaging aesthetic result

            $.ajax({
                url: ' @Url.Action("PackagingQcResult", "Production")',
                type: 'Post',
                data: JSON.stringify({ productionMaster: productionMaster, rework: rework }),
                dataType: 'json',
                async: false,
                contentType: 'application/json',
                success: function(result) {

                    if (result.IsSuccess) {
                        //iziToast.success({
                        //    timeout: 2000,
                        //    imageWidth: 150,
                        //    position: 'center',
                        //    title: 'Success',
                        //    message: 'Information Saved Successfully'
                        //});
                        location.reload();
                        AllClear();
                        CountPackagingQc();
                        //GetLastthreeEntry();
                        $("#txtImei").val('');
                        $("#txtImei1").val('');
                        $("#txtImei2").val('');
                        return true;
                        //location.reload();
                    } else {
                        iziToast.warning({
                            timeout: 2000,
                            imageWidth: 100,
                            position: 'center',
                            title: 'Warning!- ',
                            message: result.Message,
                            backgroundColor: '#E70F0F',
                            theme: 'dark', // dark
                            zindex: 999,
                            progressBarColor: '#091B2B',
                            titleSize: 15,
                            messageColor: '#FDFEFE',
                            messageSize: 15,

                        });
                        $("#txtImei").val('');
                        $("#txtImei1").val('');
                        $("#txtImei2").val('');
                        AllClear();
                    }

                },
                error: function(result, textStatus, jqXHR) {
                    iziToast.error({
                        timeout: 2000,
                        imageWidth: 150,
                        position: 'center',
                        title: 'Error',
                        message: result
                    });

                    //return false;
                }
            });
            //save packaging aesthetic result

            
        }

        if (lastTwoDigits.toLowerCase() == '-n') {
            GetAllIssueListAesthetic();
            $('#myModal').modal('show'); //changed by asif 
            //$("#txtImei").val(imei1.substring(0, imei1.length - 2));
            //$("#divIssue").show();
            //$("#txtIssues").focus();
        }



    });

</script>



