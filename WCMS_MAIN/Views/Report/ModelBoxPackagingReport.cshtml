@{
    ViewBag.Title = "ModelBoxPackagingReport";
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-8 offset-2">
            <div class="card" style="border: 2px solid ; height: 350px;">
                <div class="card-header d-flex align-items-center" style="background-color: darkslateblue; color: white">
                    <h3 class="h4" style="font-weight: normal"> Search Criteria</h3>
                </div>
                <div class="card-body text-center">
                    <div class="form-group row">
                        <label class="col-sm-3 form-control-label">&nbsp;</label>
                        <label class="col-sm-2 form-control-label">From:</label>
                        <div class="col-sm-4">
                            <input id="txtReqDate" type="text" placeholder="Requisition Date" class="form-control form-control-success txtDate">
                        </div>

                      
                    </div>
                    
                    
                    <div class="form-group row">
                        <label class="col-sm-3 form-control-label">&nbsp;</label>
                        <label class="col-sm-2 form-control-label">To:</label>
                        <div class="col-sm-4">
                            <input id="txtToDate" type="text" placeholder="Requisition Date" class="form-control form-control-success txtDate">
                        </div>

                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 form-control-label">&nbsp;</label>
                        <label class="col-sm-2 form-control-label">Project:</label>

                        <div class="col-sm-4" id="divProj" style="">
                            <select id="txtProject" data-placeholder="Choose a Project" class="chosen-select form-control" tabindex="1"></select>
                        </div>


                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 form-control-label">&nbsp;</label>
                        <div class="col-sm-4">
                            <button type="button" class="btn btn-primary" style="" id="btSearch">Search</button>

                        </div>

                    </div>

                    <div class="form-group row">
                        <label class="col-sm-4 form-control-label">&nbsp;</label>
                        <div class="col-sm-4" id="img" style="display:none;">
                            <img src="~/img/Filling.gif" style="margin-left: 50px;width: 40px;height: 40px;" />..Loading Please Wait


                        </div>

                    </div>

                </div>

            </div>


        </div>

    </div>
</div>

<div class="col-lg-12">


    <div class="card" style="border: 2px solid darkcyan;display: none;" id="tblDataDiv">
        <div class="card-header d-flex align-items-center" style="background-color: darkcyan;color: white">
            <h3 class="h4" style="font-weight: normal">Report Data </h3>
        </div>
        <div class="card-body">
            @*<div class="form-group row">
                <label class="col-sm-4 form-control-label">&nbsp;</label>
                <div class="col-sm-4">
                    <button type="button" class="btn btn-primary" style="" id="btnPrint">Search</button>

                </div>

            </div>*@
            <div class="form-horizontal" id="divTableData" style="overflow: auto;text-align: center">

              
                <table class="table table-bordered" border="1" cellpadding="3" id="tblData">
                    <thead class="" style="background-color:whitesmoke; color: black; font-size: 18px;text-align: center; border-radius: 50px; ">
                        <tr>
                            <th style="">
                                Wo_Id
                            </th>
                            <th style="">
                                Project
                            </th>
                            
                            <th>
                                Production Count
                            </th>
                            <th>
                                From Date
                            </th>
                            <th>
                               To Date
                            </th>

                            <th>
                                Action
                            </th>
                        </tr>
                    </thead>
                    <tbody class="tbody"></tbody>
                </table>



            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="myModalShort" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
               
            </div>
            <div class="modal-body">
                <table id="datatableDetails" class="table  table-bordered " width="900" cellspacing="0">

                    <thead>
                        <tr>
                           
                            <th>Wo_Id</th>
                            <th>Box Id</th>
                            <th>Imei1</th>
                            <th>Imei2</th>
                            <th>SN</th>

                        </tr>
                    </thead>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
               
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->




<link href="~/js/vendor/JqueryChoosen/chosen-bootstrap.css" rel="stylesheet" />
<link href="~/css/iziToast.min.css" rel="stylesheet" />
<link href="~/js/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
<link href="~/js/vendor/JqueryChoosen/chosen.css" rel="stylesheet" />

<link href="~/js/vendor/DatatablePrint/jquery-ui-1.12.1.css" rel="stylesheet" />
<link href="~/js/vendor/DatatablePrint/jquery.dataTables-1.10.9.css" rel="stylesheet" />
<link href="~/js/vendor/DatatablePrint/dataTables-2.2.4.tableTools.min.css" rel="stylesheet" />
<script src="~/js/vendor/DatatablePrint/jquery-ui-1.12.1.js"></script>

<script src="~/js/iziToast.min.js"></script>
<script src="~/js/vendor/chart.js/Chart.min.js"></script>
<script src="~/js/vendor/JqueryChoosen/chosen.jquery.min.js"></script>

<script src="~/js/vendor/DatatablePrint/jquery.dataTable-1.10.9.min.js"></script>
<script src="~/js/vendor/DatatablePrint/buttons.colVis.min.js"></script>
<script src="~/js/vendor/DatatablePrint/buttons.flash.min.js"></script>
<script src="~/js/vendor/DatatablePrint/buttons.html5.min.js"></script>
<script src="~/js/vendor/DatatablePrint/buttons.print.min.js"></script>
<script src="~/js/vendor/DatatablePrint/dataTables.buttons.min.js"></script>
<script src="~/js/vendor/DatatablePrint/dataTables.foundation.min.js"></script>
<script src="~/js/vendor/DatatablePrint/vfs_fonts.js"></script>
<script src="~/js/vendor/DatatablePrint/pdfmake.min.js"></script>
<script src="~/js/vendor/DatatablePrint/jszip.min.js"></script>
<script src="~/js/vendor/DatatablePrint/dataTables.buttons.min.js"></script>
<script src="~/js/vendor/DatatablePrint/dataTables.foundation.min.js"></script>


<script>
    
    function PrintData() {
        var divToPrint = document.getElementById("divTableData");
        var newWin = window.open("");
        newWin.document.write(divToPrint.outerHTML);
        newWin.print();
        newWin.close();
    }

    $("#btnPrint").click(function () {
        PrintData();
    });
   

    $(function() {

        LoadAllProjectsVsun();
        $("#txtReqDate").datepicker({ dateFormat: 'dd-mm-yy' }).datepicker("setDate", new Date());
        $("#txtToDate").datepicker({ dateFormat: 'dd-mm-yy' }).datepicker("setDate", new Date());

    });
            

    $("#btSearch").click(function() {

        $('#img').show();


        setTimeout(function () {
            GetBoxPackingData();
        }, 1000);
                
    });
            

    function LoadAllProjectsVsun() {

        var url = "@Url.Action("GetProjecFormvsunDb", "Project")";
        $.getJSON(url, function(json) {
            var elem = $("#txtProject");
            $("#txtProject").chosen("destroy");
            elem.empty();

            elem.append("<option value='0'>Choose Project</option>");

            $.each(json, function(idx, obj) {

                elem.append('<option value="' + obj.Id + '">' + obj.value + '</option>');
            });

            elem.chosen({ width: "100%", height: "10px" });

            //$(".chosen-select").chosen({ height: "10%" });


        });
    }


    function GetBoxPackingData() {
                
        var gridateFrom = $("#txtReqDate").val().split('-');
        var fromdate = gridateFrom[2] + "-" + gridateFrom[1] + "-" + gridateFrom[0];

        var gridateTo = $("#txtToDate").val().split('-');
        var todate = gridateTo[2] + "-" + gridateTo[1] + "-" + gridateTo[0];
        var project = $("#txtProject").val();
                
        $.ajax({
            url: ' @Url.Action("GetBoxPackingData", "Report")',
            type: 'Post',
            data: JSON.stringify({ fromdate: fromdate, todate: todate, project: project }),
            dataType: 'json',
            async: false,
            contentType: 'application/json',
            success: function(result) {

                if (result.length > 0) {
                    $('#tblDataDiv').show();
                    $.each(result, function(index, itemData) {
                        //new logic
                        var row = "<tr class='active' style='font-size=5px;height:3px;'>" +
                            "<td style='height:5px;' class='text-center'>" + itemData.WoId + "</td>" +
                            "<td style='height:5px;' class='text-center'>" + project + "</td>" +
                            "<td style='height:3px'; class='text-center'>" + itemData.ProductionCount + "</td>" +
                            "<td style='height:3px'; class='text-center'>" + fromdate + "</td>" +
                            "<td style='height:3px'; class='text-center'>" + todate + "</td>" +
                            "<td><button type=button class=btn btn-primary id=linkClick>Details</button></td>" +
                            "</tr>";


                        $('#tblData tbody').append(row);
                    });

                    $('#img').hide();
                } else {

                    iziToast.warning({
                        timeout: 1000,
                        imageWidth: 100,
                        position: 'center',
                        title: 'Warning!- ',
                        message: 'No Data Found !',
                        backgroundColor: '#E70F0F',
                        theme: 'dark', // dark
                        zindex: 999,
                        progressBarColor: '#091B2B',
                        titleSize: 15,
                        messageColor: '#FDFEFE',
                        messageSize: 15,
                    });
                    $('#img').hide();
                }

            },
            error: function(result, textStatus, jqXHR) {

            }
        });


    }

    $(document).on("click", "#linkClick", function() {
        debugger;

        var woid = $(this).closest("tr").find('td:eq(0)').text(); // Find the row
        var project = $(this).closest("tr").find('td:eq(1)').text(); // Find the row
        var fromdate = $(this).closest("tr").find('td:eq(3)').text(); // Find the row
        var todate = $(this).closest("tr").find('td:eq(4)').text(); // Find the row

        GetDetailsWithBoxCode(woid, project, fromdate, todate);


    });

    function GetDetailsWithBoxCode(woid, project, fromdate, todate) {
        

        var printCounter = 0;
        var buttonCommon = {
            //exportOptions: {
            //    format: {
            //        body: function (data, row, column, node) {
            //            // Strip $ from salary column to make it numeric
            //            return column === 5 ?
            //                data.replace(/[$,]/g, '') :
            //                data;
            //        }
            //    }
            //}
        };

        var table = $('#datatableDetails').DataTable({
            "ajax": {
                "url": "@Url.Action("GetVsunWoDetails", "Report")",
            "type": "GET",
            "data": function(d) {
                d.woid = woid;
                d.project = project;
                d.fromdate = fromdate;
                d.todate = todate;
            },
            "datatype": "json"
        },
                "destroy": true,
                "columnDefs":
                [{
                        "searchable": true,

            visible: false
    },
                
    { "width": "10%", "targets": 1 }
    ],
    "pageLength":100,

    "scrollY": "500px",
    "dom": 'Bfrtip',
    "buttons": [
           
        $.extend(true, {}, buttonCommon, {
            extend: 'excelHtml5',
            text: '<i class="fa fa-file-excel-o"></i> Excel',
            title: 'Production  Packing Box Result'                   
        }),
    {
        extend: 'csvHtml5',
        text: '<i class="fa fa-files-o"></i> Csv',
        exportOptions: { orthogonal: 'export' },
        title: 'Tp-Lcd Production'
    },
               
        {

            extend: 'print',
            text: '<i class="fa fa-print"></i> Print',
            title: 'Tp-Lcd Production ',
            messageTop: "Production Packing Box Result </br> ",
            orientation: 'landscape',
            pageSize: 'LEGAL',
            exportOptions: {
                columns: ':not(.no-print)'
            },
            footer: false,
            autoPrint: true

        },


        'colvis'
    ],

    "columns": [
        { "data": "WoId", "autoWidth": true, "searchable": true },
         { "data": "BoxId", "autoWidth": true, "searchable": true },
         { "data": "Imei1", "autoWidth": true, "searchable": true },
         { "data": "Imei2", "autoWidth": true, "searchable": true },
         { "data": "Sn", "autoWidth": true, "searchable": true }
               
    ]
            


    });




    table.buttons().container()
        .appendTo('#datatable_wrapper .small-4.columns:eq(0)');




    setTimeout(function () {
        $('#myModalShort').modal('show');
    }, 1000);

    }

</script>
